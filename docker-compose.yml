# =============================================================================
# Travel Planner - Docker Compose for Local Development/Testing
# =============================================================================

services:
  travel-planner:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: travel-planner
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - HOST=0.0.0.0
      - ORIGIN=${ORIGIN:-http://localhost:3000}
      - DATABASE_PATH=/app/data/cache.db
      # Rate limiting
      - RATE_LIMIT_WINDOW_MS=${RATE_LIMIT_WINDOW_MS:-60000}
      - RATE_LIMIT_MAX_WEATHER=${RATE_LIMIT_MAX_WEATHER:-100}
      - RATE_LIMIT_MAX_FLIGHTS=${RATE_LIMIT_MAX_FLIGHTS:-50}
      - RATE_LIMIT_MAX_ROUTING=${RATE_LIMIT_MAX_ROUTING:-200}
      - RATE_LIMIT_MAX_GEOCODING=${RATE_LIMIT_MAX_GEOCODING:-100}
      - RATE_LIMIT_MAX_CITIES=${RATE_LIMIT_MAX_CITIES:-100}
      - RATE_LIMIT_MAX_PLACES=${RATE_LIMIT_MAX_PLACES:-100}
      # Set to 'true' when behind a reverse proxy (nginx, cloudflare, etc.)
      # to trust X-Forwarded-For/X-Real-IP headers for rate limiting
      - TRUST_PROXY=${TRUST_PROXY:-false}
      # API keys (from .env file or host environment)
      - GEOAPIFY_API_KEY=${GEOAPIFY_API_KEY:-}
      - FOURSQUARE_API_KEY=${FOURSQUARE_API_KEY:-}
      - GOOGLE_PLACES_API_KEY=${GOOGLE_PLACES_API_KEY:-}
      - TIMEZONEDB_API_KEY=${TIMEZONEDB_API_KEY:-}
      - AERODATABOX_API_KEY=${AERODATABOX_API_KEY:-}
      - AERODATABOX_HOST=${AERODATABOX_HOST:-aerodatabox.p.rapidapi.com}
    volumes:
      # Persist SQLite cache across container restarts
      - travel-planner-data:/app/data
    restart: unless-stopped
    # Healthcheck relies on the one defined in Dockerfile

volumes:
  travel-planner-data:
    name: travel-planner-data
